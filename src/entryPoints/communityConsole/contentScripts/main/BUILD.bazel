load("//tools:common_ts_project.bzl", "common_ts_project")
load("//tools/preprocessor:bzl/preprocessor.bzl", "preprocessor")

preprocessor(
    name = "preprocessed_main",
    src = "main.pre.ts",
    out = "main.ts",
    defined_dependencies = select({
        "//:mv3": ["MV3"],
        "//conditions:default": [],
    }),
)

common_ts_project(
    name = "main",
    srcs = [":preprocessed_main"],
    allow_js = True,
    declaration = True,
    source_map = True,
    transpiler = "tsc",
    tsconfig = "//:tsconfig_pkg",
    visibility = [
        "//:__pkg__",
    ],
    deps = [
        "//src/common/architecture/dependenciesProvider",
        "//src/features/autoRefresh/core",
        "//src/features/autoRefresh/presentation/nodeWatcherHandlers",
        "//src/features/autoRefresh/presentation/scripts",
        "//src/features/avatars/core",
        "//src/features/avatars/presentation/nodeWatcherHandlers",
        "//src/features/avatars/presentation/scripts",
        "//src/features/batchLock/infrastructure/ui/injectors",
        "//src/features/batchLock/presentation/nodeWatcherHandlers",
        "//src/features/batchLock/presentation/scripts",
        "//src/features/bulkMove/infrastructure/repositories/api",
        "//src/features/bulkMove/infrastructure/ui/injectors",
        "//src/features/bulkMove/presentation/nodeWatchHandlers",
        "//src/features/bulkReportReplies/infrastructure/repositories/api/reportAbuse",
        "//src/features/bulkReportReplies/infrastructure/repositories/api/reportOffTopic",
        "//src/features/bulkReportReplies/infrastructure/repositories/itemInfo",
        "//src/features/bulkReportReplies/infrastructure/ui/injectors",
        "//src/features/bulkReportReplies/presentation/nodeWatcherHandlers",
        "//src/features/bulkReportReplies/presentation/scripts",
        "//src/features/bulkReportReplies/services",
        "//src/features/ccDarkTheme/core/logic",
        "//src/features/ccDarkTheme/presentation/nodeWatcherHandlers",
        "//src/features/ccDragAndDropFix/presentation/nodeWatcherHandlers",
        "//src/features/ccForceHideDrawer/presentation/scripts",
        "//src/features/enhancedAnnouncementsDot/presentation/scripts",
        "//src/features/extraInfo/core",
        "//src/features/extraInfo/presentation/nodeWatcherHandlers/profile",
        "//src/features/extraInfo/presentation/nodeWatcherHandlers/thread",
        "//src/features/extraInfo/presentation/nodeWatcherHandlers/threadList",
        "//src/features/extraInfo/presentation/scripts",
        "//src/features/fixCrPopup/presentation/scripts",
        "//src/features/fixedToolbar/presentation/scripts",
        "//src/features/flattenThreads/core",
        "//src/features/flattenThreads/presentation/nodeWatcherHandlers",
        "//src/features/imageMaxHeight/presentation/scripts",
        "//src/features/increaseContrast/presentation/scripts",
        "//src/features/infiniteScroll/core",
        "//src/features/infiniteScroll/presentation/nodeWatcherHandlers",
        "//src/features/logStartupData/presentation/scripts",
        "//src/features/previousPosts/presentation/handlers",
        "//src/features/profileIndicator/presentation/scripts",
        "//src/features/repositionExpandThread/presentation/scripts",
        "//src/features/stickySidebarHeaders/presentation/scripts",
        "//src/features/threadPageDesignWarning/core",
        "//src/features/threadPageDesignWarning/presentation/nodeWatcherHandlers",
        "//src/features/threadToolbar/core",
        "//src/features/threadToolbar/presentation/nodeWatcherHandlers",
        "//src/features/threadToolbar/presentation/scripts",
        "//src/features/workflows/core/communityConsole",
        "//src/features/workflows/core/communityConsole/import",
        "//src/features/workflows/presentation/nodeWatcherHandlers",
        "//src/features/workflows/presentation/scripts",
        "//src/infrastructure/presentation/nodeWatcher",
        "//src/infrastructure/presentation/scripts",
        "//src/infrastructure/services/communityConsole",
        "//src/infrastructure/services/options",
        "//src/infrastructure/ui/injectors/communityConsole",
        "//src/infrastructure/ui/services/communityConsole",
        "//src/options/infrastructure/repositories",
        "//src/presentation/nodeWatcher",
        "//src/presentation/standaloneScripts/litComponents",
        "//src/presentation/standaloneScripts/startupDataStorage",
        "//src/presentation/standaloneScripts/xhrInterceptor",
        "//src/storage/compositionRoot",
    ],
)
